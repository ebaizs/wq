<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="color-scheme" content="light dark">
    <title>装饰项目管理系统</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 手势返回锁定提示 -->
    <div class="back-gesture-lock" id="backGestureLock">
        连续2次返回手势可退出
    </div>
    
    <!-- 登录页面 -->
    <div class="login-page" id="loginPage">
        <div class="login-box">
            <h2>立诺装饰 项目管理系统</h2>
            <form id="loginForm">
                <input type="text" id="username" placeholder="用户名" required>
                <input type="password" id="password" placeholder="密码" required>
                <button type="submit">登录</button>                
                <div class="login-error" id="loginError"></div>
            </form>
        </div>
    </div>

    <!-- 主容器 -->
    <div class="container hidden" id="mainContainer">
        <!-- 头部 -->
        <div class="header">
            <div class="header-left">
                <h1>立诺装饰项目管理系统</h1>   清扬    15662061321
            </div>
           <!-- 在header-right部分添加 -->
<div class="header-right">
    <button class="btn btn-info" onclick="saveToGitHub()" title="手动同步到GitHub">
        保存到云端
    </button>
    <button class="btn btn-warning" onclick="loadFromGitHub()" title="从GitHub加载">
        从云端加载
    </button>
    <!-- 添加配置管理按钮 -->
    <button class="btn btn-secondary" onclick="manageGithubConfig()" title="管理GitHub配置">
        配置管理
    </button>
    <button class="change-log-btn" onclick="showChangeLog()">更改日志</button>
</div>
        </div>

        <!-- 主内容区 -->
        <div class="main-content" id="mainContent">
            <!-- 在 import-export 部分添加 -->
            <!-- 修改 import-export 部分 -->
            <div class="import-export">
                <div class="button-row">
                    <button class="btn btn-warning" onclick="saveToJsFile()" title="保存为可直接加载的shuju.js文件">
                        备份完整数据
                    </button>
                    <button class="btn btn-primary" onclick="downloadJsonData()" title="下载JSON格式数据">
                        下载JSON数据
                    </button>
                    <button class="btn btn-info" onclick="loadFromJsFile()" title="从JSON/JS/ZIP文件加载数据">
                        从文件加载数据
                    </button>
                    <!-- 修改为独立的样式，确保在移动端可点击 -->
                    <button class="btn btn-success mobile-upload-btn" onclick="loadImagesZipOnly()" 
                            title="仅加载图片数据包（不覆盖文本）" style="min-height: 44px;">
                        加载图片数据包
                    </button>
                </div>
            </div>

            <!-- 用户信息和退出按钮 -->
            <div class="user-info-section">
                <span id="currentUser"></span>
                <button class="logout-btn" onclick="logout()">退出登录</button>
            </div>

            <!-- 添加工地按钮 -->
            <button class="add-site-btn" onclick="showAddSiteModal()">+ 添加工地</button>

            <!-- 工地列表 -->
            <div class="site-list" id="siteList"></div>
        </div>

        <!-- 工地详情模态框 -->
        <div class="modal" id="siteModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalTitle">工地详情</h3>
                    <button class="close-btn" onclick="closeSiteModal()">&times;</button>
                </div>

                <div class="tabs" id="siteTabs"></div>

                <div class="tab-content" id="progressTab">
                    <div class="form-group">
                        <label>工地名称</label>
                        <input type="text" id="siteName" class="form-control" maxlength="15" placeholder="15字符" style="width: 100%;">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>开工时间</label>
                            <input type="date" id="startDate">
                        </div>
                        <div class="form-group">
                            <label>计划完工时间</label>
                            <input type="date" id="endDate">
                        </div>
                        <div class="form-group" style="width: 100%;">
                            <label>当前进度: <span id="progressValue">0</span>%</label>
                            <input type="range" id="progress" min="0" max="100" value="0" style="width: 100%;" oninput="updateProgressValue(this.value)">
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%">0%</div>
                    </div>
                    <button class="btn btn-primary" onclick="saveSiteInfo()">保存工地信息</button>
                    
                    <!-- 待办事项 -->
                    <h4 style="margin-top: 30px;">待办事项</h4>
                    <div class="form-group">
                        <label>事项名称</label>
                        <input type="text" id="todoItem" maxlength="20" placeholder="20字符以内">
                    </div>
                    <div class="form-group" style="flex: 2;">
                        <label>备注说明（30字符以下）</label>
                        <textarea id="todoNote" maxlength="30" placeholder="请输入30个以下字符的备注说明"></textarea>
                    </div>
                    <button class="btn btn-success" onclick="addTodo()">添加待办</button>
                    <div class="data-table-container">
                        <div id="todoList"></div>
                    </div>
                </div>

                <div class="tab-content" id="expenseTab">
                    <h4>支出记录</h4>
                    <div class="form-row">
                        <div class="form-group" style="flex: 2;">
                            <label>支出项目</label>
                            <input type="text" id="expenseItem" maxlength="8" placeholder="8字符">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>单位</label>
                            <input type="text" id="expenseUnit" maxlength="6" value="项" placeholder="单位" readonly>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label>金额</label>
                            <input type="number" id="expenseAmount" min="0" step="0.01" placeholder="金额">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>备注说明（30字符以下）</label>
                        <textarea id="expenseNote" maxlength="30" placeholder="请输入30个以下字符的备注说明"></textarea>
                    </div>
                    <button class="btn btn-success" onclick="addExpense()">添加支出</button>
                    <div class="data-table-container">
                        <div id="expenseList"></div>
                    </div>
                </div>

                <div class="tab-content" id="requirementTab">
                    <h4>客户要求</h4>
                    <div class="form-group">
                        <label>要求内容（10字符以下）</label>
                        <textarea id="requirementContent" maxlength="10" placeholder="请输入10个字符以下的要求内容"></textarea>
                    </div>
                    <div class="form-group">
                        <label>备注说明（40字符以下）</label>
                        <textarea id="requirementNote" maxlength="40" placeholder="请输入40个字符以下的备注说明"></textarea>
                    </div>
                    <button class="btn btn-success" onclick="addRequirement()">添加要求</button>
                    <div class="data-table-container">
                        <div id="requirementList"></div>
                    </div>
                </div>

                <div class="tab-content" id="repairTab">
                    <h4>待维修项</h4>
                    <div class="form-group">
                        <label>维修内容（10字符以下）</label>
                        <textarea id="repairContent" maxlength="10" placeholder="请输10个字符以下的维修内容"></textarea>
                    </div>
                    <div class="form-group">
                        <label>备注说明（40字符以下）</label>
                        <textarea id="repairNote" maxlength="40" placeholder="请输40个字符以下的备注说明"></textarea>
                    </div>
                    <div class="form-group">
                        <label>上传照片</label>
                        <div class="file-upload">
                            <input type="file" id="repairPhoto" accept="image/*" onchange="previewRepairPhoto(event)">
                            <label class="file-upload-label">点击上传维修照片</label>
                        </div>
                        <div id="repairPhotoPreview"></div>
                    </div>
                    <button class="btn btn-success" onclick="addRepair()">添加维修项</button>
                    <div class="data-table-container">
                        <div id="repairList"></div>
                    </div>
                </div>

                <div class="tab-content" id="workerTab">
                    <h4>施工工人</h4>
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label>姓名</label>
                            <input type="text" id="workerName" maxlength="8" placeholder="8字符">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>工种</label>
                            <input type="text" id="workerType" maxlength="6" placeholder="6字符">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>开始时间</label>
                            <input type="date" id="workerStartTime">
                        </div>
                        <div class="form-group">
                            <label>结束时间</label>
                            <input type="date" id="workerEndTime">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>备注说明（40字符以下）</label>
                        <textarea id="workerNote" maxlength="40" placeholder="请输入40个以下字符的备注说明"></textarea>
                    </div>
                    <button class="btn btn-success" onclick="addWorker()">添加工人</button>
                    <div class="data-table-container">
                        <div id="workerList"></div>
                    </div>
                </div>

                <div class="tab-content" id="quoteTab">
                    <h4>报价管理</h4>
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label>基础装修报价</label>
                            <input type="number" id="basicQuote" min="0" step="0.01" placeholder="基础装修报价" ${!canEditQuote() ? 'readonly' : ''}>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>主材报价</label>
                            <input type="number" id="materialQuote" min="0" step="0.01" placeholder="主材报价" ${!canEditQuote() ? 'readonly' : ''}>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label>设备报价</label>
                            <input type="number" id="equipmentQuote" min="0" step="0.01" placeholder="设备报价" ${!canEditQuote() ? 'readonly' : ''}>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>家具配饰报价</label>
                            <input type="number" id="furnitureQuote" min="0" step="0.01" placeholder="家具配饰报价" ${!canEditQuote() ? 'readonly' : ''}>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label>其他报价</label>
                            <input type="number" id="otherQuote" min="0" step="0.01" placeholder="其他报价" ${!canEditQuote() ? 'readonly' : ''}>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>增减项冲减合计</label>
                            <input type="number" id="addRemoveTotalQuote" min="0" step="0.01" placeholder="增减项冲减合计" readonly>
                        </div>
                    </div>
                    <div class="summary-section">
                        <h5>报价汇总</h5>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <div class="summary-label">基础装修报价</div>
                                <div class="summary-value" id="basicQuoteDisplay">¥0.00</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">主材报价</div>
                                <div class="summary-value" id="materialQuoteDisplay">¥0.00</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">设备报价</div>
                                <div class="summary-value" id="equipmentQuoteDisplay">¥0.00</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">家具配饰报价</div>
                                <div class="summary-value" id="furnitureQuoteDisplay">¥0.00</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">其他报价</div>
                                <div class="summary-value" id="otherQuoteDisplay">¥0.00</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">增减项冲减合计</div>
                                <div class="summary-value" id="addRemoveTotalQuoteDisplay">¥0.00</div>
                            </div>
                            <div class="summary-item" style="grid-column: span 2; background: #e3f2fd;">
                                <div class="summary-label">合同总造价</div>
                                <div class="summary-value" id="totalQuoteDisplay">¥0.00</div>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="saveQuote()" ${!canEditQuote() ? 'disabled' : ''}>保存报价</button>
                </div>

                <div class="tab-content" id="addRemoveTab">
                    <h4>增减项</h4>
                    <div class="form-row">
                        <div class="form-group" style="flex: 2;">
                            <label>项目名称</label>
                            <input type="text" id="addRemoveItem" maxlength="8" placeholder="8字符">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>类型</label>
                            <select id="addRemoveType">
                                <option value="add">增加</option>
                                <option value="remove">减少</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label>单位</label>
                            <input type="text" id="addRemoveUnit" maxlength="4" value="项" placeholder="单位" readonly>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label>金额</label>
                            <input type="number" id="addRemoveAmount" min="0" step="0.01" placeholder="金额">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>备注说明（40字符以下）</label>
                        <textarea id="addRemoveNote" maxlength="40" placeholder="请输入40个以下字符的备注说明"></textarea>
                    </div>
                    <button class="btn btn-success" onclick="addAddRemoveItem()">添加增减项</button>
                    <div class="data-table-container">
                        <div id="addRemoveList"></div>
                    </div>
                    <div style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                        <h5>增减项冲减合计 = 增项 - 减项</h5>
                        <div style="font-size: 18px; font-weight: bold; color: #333;" id="addRemoveSummary">¥0.00</div>
                    </div>
                </div>

                <div class="tab-content" id="drawingTab">
                    <h4>图纸管理</h4>
                    <div class="form-group">
                        <label>图纸类型</label>
                        <select id="drawingType">
                            <option value="design">设计图纸</option>
                            <option value="quote">报价表</option>
                            <option value="other">其他</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>上传图纸</label>
                        <div class="file-upload">
                            <input type="file" id="drawingFile" accept=".pdf,.jpg,.jpeg,.png,.xls,.xlsx,.doc,.docx,.csv" 
                                   onchange="previewDrawing(event)">
                            <label class="file-upload-label">点击上传图纸（支持PDF、图片、表格格式）</label>
                        </div>
                        <div id="drawingPreview"></div>
                    </div>
                    <div class="form-group">
                        <label>备注说明（40字符以下）</label>
                        <textarea id="drawingNote" maxlength="40" placeholder="请输入40个字符以下的备注说明"></textarea>
                    </div>
                    <button class="btn btn-success" onclick="uploadDrawing()">上传图纸</button>
                    <div class="data-table-container">
                        <div id="drawingList"></div>
                    </div>
                </div>

                <div class="tab-content" id="experienceTab">
                    <h4>经验总结</h4>
                    <div class="form-group">
                        <label>经验总结内容</label>
                        <textarea id="experienceContent" rows="8" placeholder="请输入项目经验总结..."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="addExperience()">添加总结</button>
                    <div id="experienceList"></div>
                </div>
            </div>
        </div>

        <!-- 更改日志页面 -->
        <div class="change-log-page" id="changeLogPage">
            <div class="modal-header">
                <h3>更改日志</h3>
                <button class="close-btn" onclick="hideChangeLog()">&times;</button>
            </div>
            <div class="import-export">
                <button class="btn btn-primary" onclick="exportChangeLog()">导出日志</button>
                <button class="btn btn-danger" onclick="clearChangeLog()">清空日志</button>
            </div>
            <div id="changeLogList"></div>
        </div>

        <!-- 图片查看器 -->
        <div class="image-viewer" id="imageViewer" onclick="hideImageViewer()">
            <span class="close-viewer">&times;</span>
            <img id="viewerImage" src="" alt="查看图片">
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="app-tables-and-utils.js"></script>
<script src="app-main.js"></script>
</body>
</html>